{"compress":true,"commitItems":[["8587cfb8-7444-43c5-a37f-14b0e3dfa56d",1605698468253,"",[[1605698463087,["Administrator@YMS-20200313EGD",[[1,0,"# Mysql汇总查询将两个结果集合并一行展示\n\n\n\n"]],[0,0],[26,26]]]],null,"Administrator@YMS-20200313EGD"],["483d6577-05d0-462b-ad01-96551b522b3a",1630380804159,"---\nlayout: Mysql汇总查询将两个结果集合并一行展示\ntitle:   Mysql汇总查询将两个结果集合并一行展示\ndate: 2019-12-13 14:37:57\ncategories: \"MYSQL\"\nabbrlink: 011c\ntags: \n- MYSQL\n- SQL语句\n---\n\n<img src=\"http://images.linyiyuan.top/zval_sep.png\" style=\"width:900px;height:400px\" />\n\n# 导言\n  今天在处理一个数据查询时，遇到一个问题，需要将同一张表不同条件的分组结果合并成一个结果集，最初以为使用union与union all 就能解决问题，后来发现事情远远没那么简单，因为他这里出现了两个不同字段，而使用union的前提就是要保证字段的相同，在查阅网上相关资料后，对该问题进行了一次总结\n\n<!--less-->\n\n## 初始化\n\n建表语句：\n\n```sql\nCREATE TABLE `test` (\n  `time` varchar(255) DEFAULT NULL,\n  `money` varchar(255) DEFAULT NULL,\n  `date` varchar(255) DEFAULT NULL\n) ENGINE=MyISAM DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;\n\n\nINSERT INTO `test`(`time`, `money`, `date`) VALUES ('1', '100', 'today');\nINSERT INTO `test`(`time`, `money`, `date`) VALUES ('2', '1000', 'today');\nINSERT INTO `test`(`time`, `money`, `date`) VALUES ('3', '10000', 'today');\nINSERT INTO `test`(`time`, `money`, `date`) VALUES ('4', '100000', 'today');\nINSERT INTO `test`(`time`, `money`, `date`) VALUES ('1', '100', 'yestoday');\nINSERT INTO `test`(`time`, `money`, `date`) VALUES ('2', '1000', 'yestoday');\nINSERT INTO `test`(`time`, `money`, `date`) VALUES ('3', '10000', 'yestoday');\nINSERT INTO `test`(`time`, `money`, `date`) VALUES ('4', '100000', 'yestoday');\n\n```\n\n预期输出：\n\n![img](https://shmily-album.oss-cn-shenzhen.aliyuncs.com/photo_album_15/6f92ca792276ad43950d22e0ffd3acec.png)\n\n## 解决方法\n\n1. 方法1：\n\n```sql\nselect \ntime,\nsum(if(date='today',money,0)) as today_money,\nsum(if(date='yestoday',money,0)) as yestoday_money\nfrom test\ngroup by time;\n```\n\n2. 方法2：\n\n```sql\nselect \ntime,\nsum(case when date='today' then money end) as today_money,\nsum(case when date='yestoday' then money end) as yestoday_money\nfrom test\ngroup by time\n```\n\n3. 方法3：\n\n```sql\nselect\n  a.time,\n  a.today_money,\n  b.yestoday_money\nfrom\n  ((\n    select\n      time,\n      sum( money ) as today_money\n    from\n      test\n    where\n      date = 'today'\n    group by\n      time\n      ) as a\n  left join ( select time, sum( money ) as yestoday_money from test where date = 'yestoday' group by time ) as b on a.time= b.time\n  )\n    \n```\n\n## 结果：\n\n![img](https://shmily-album.oss-cn-shenzhen.aliyuncs.com/photo_album_15/3b64b201f46f3d16f98e61f3f8e66c45.png)\n\n\n## 参考文章\n1. [mysql sql汇总查询将两个结果集合并一行展示](https://jingyan.baidu.com/article/4ae03de3df93cc3eff9e6b37.html)\n",[[1630380802921,["Administrator@YMS-20200313EGD",[[-1,123,"1"]],[124,124],[123,123]]],[1630380803086,["Administrator@YMS-20200313EGD",[[1,123,"3"]],[123,123],[124,124]]],[1630380803568,["Administrator@YMS-20200313EGD",[[-1,124,"c"]],[124,124],[124,124]]],[1630380803850,["Administrator@YMS-20200313EGD",[[1,124,"a"]],[124,124],[125,125]]]],null,"Administrator@YMS-20200313EGD"]]}